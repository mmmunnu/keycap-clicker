<script>
  let audioCtx = null;
  let buffer = null;
  let count = 0;
  let current = "blue";

  const soundUrls = {
    blue: "https://assets.mixkit.co/sfx/preview/mixkit-mechanical-keyboard-single-press-2531.mp3",
    red: "https://assets.mixkit.co/sfx/preview/mixkit-keyboard-typing-1386.mp3",
    brown: "https://assets.mixkit.co/sfx/preview/mixkit-computer-keyboard-click-1138.mp3"
  };

  async function initAudio() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const res = await fetch(soundUrls[current]);
      const arrayBuffer = await res.arrayBuffer();
      buffer = await audioCtx.decodeAudioData(arrayBuffer);
    }
  }

  async function playSound() {
    if (!audioCtx) {
      await initAudio();
      return; // 첫 터치는 오디오 unlock 용
    }

    const source = audioCtx.createBufferSource();
    source.buffer = buffer;
    source.connect(audioCtx.destination);
    source.start(0);

    count++;
    document.getElementById("count").textContent = count;
  }

  document.body.addEventListener("touchstart", playSound);
  document.body.addEventListener("click", playSound);

  document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", async e => {
      e.stopPropagation();
      current = btn.dataset.sound;

      document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // 사운드 다시 로드
      audioCtx = null;
      buffer = null;
      await initAudio();
    });
  });
</script>
